local All_Items_Name = {
	['Block'] = true,
	['Food'] = true,
	['Fuse'] = true,
	['Battery'] = true,
}
print('Thanks!')
--Block.TouchTrigger.TouchInterest
--workspace.GroupBuildStructures.BlockTower.Trigger.TouchInterest
local firetouchinterest

do
	local GEnv = getgenv();
	local touched
	firetouchinterest = GEnv.firetouchinterest or function(part1, part2, toggle)
		if (part1 and part2) then
			if (toggle == 0) then
				touched = part1.CFrame
				part1.CFrame = part2.CFrame
			else
				part1.CFrame = touched
				touched = nil
			end
		end
	end
end

local CurrentMode = ''

local function FireAll()
	for i, v:Instance in pairs(workspace:GetDescendants()) do
		if v:IsA('TouchTransmitter') then
			firetouchinterest(game.Players.LocalPlayer.Character:WaitForChild('HumanoidRootPart'), v.Parent, 0);
			wait();
			firetouchinterest(game.Players.LocalPlayer.Character:WaitForChild('HumanoidRootPart'), v.Parent, 1);
		end
	end
end

local function Doing(child:Instance,ThisMode:string)
	if CurrentMode == ThisMode then
		return ThisMode
	end
	
	CurrentMode = ThisMode
	local AmoutLoop = 0
	repeat
		AmoutLoop += 1
		local IsHave,_ = pcall(function()
			loadstring('return workspace.'..child.Name)()
		end)
		print(IsHave)
		print(child:GetFullName())
		FireAll()
		wait()
		if AmoutLoop >= 10 then AmoutLoop = 0 break end
		if IsHave == false or CurrentMode == '' then print('break!') break end
		print('Not yet :(')
	until IsHave == false
	print('Yet!')
	local l:Instance = workspace.GroupBuildStructures:FindFirstChildWhichIsA('Model'):WaitForChild('Trigger')
	firetouchinterest(game.Players.LocalPlayer.Character:WaitForChild('HumanoidRootPart'),l,0)
	wait();
	firetouchinterest(game.Players.LocalPlayer.Character:WaitForChild('HumanoidRootPart'),l,1)
	CurrentMode = ''
end


workspace.ChildAdded:Connect(function(child)
	if child.Name == 'Purple_ArmIdle' then wait() return child:Destroy() end
	if child:IsA('Model') then
		if All_Items_Name[child.Name] ~= nil then
			Doing(child,child.Name)
		else
			if child.Name == 'Map_Finale' then
				FireAll()
			end
			for Name,v in pairs(All_Items_Name) do
				if string.match(child.Name,Name) then
					Doing(child,Name)
				end
			end
		end
		
	end
end)
pcall(function()
	workspace.Map_Finale.BalloonObstacles:FindFirstChildWhichIsA('MeshPart').ChildAdded:Connect(function(child)
		task.wait(0.1)
		FireAll() --Just poop ballons :)
	end)
end)
